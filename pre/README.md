# Office 365 SOA Pre-requisites

## Introduction

The Office 365 Security Optimization Assessment toolset has several pre-requisites that need to be installed or configured. The tool runs in PowerShell, and connects to various Office 365 services.

## Pre-requisite Breakdown

Pre-requisite installation is simplified by the use of a PowerShell pre-requisite script

The following pre-requsites are installed, or updated by the pre-requisite installation script.
* Azure AD MSOnline PowerShell Module
* Azure AD Preview PowerShell Module
* SharePoint Online PowerShell Module
* SharePoint PNP PowerShell Module
* Skype for Business PowerShell Module

The following pre-requisites are removed
* SharePoint Online PowerShell Module - if manually installed, this is removed from your PS Module Path to prevent conflicts
* Azure AD (Non Preview) Module - which conflicts with the required Azure AD Preview module

An Azure AD application is also installed in to your tenancy. For more information on this see below

## Pre-requisite Script

### Requirements

In order to run the pre-requisite script, you must have:
* Local Admin Access to the workstation that you will perform the collection from

### Running the pre-requisite script

1. Download the Get-SOAPrerequsiites.ps1 script to a folder on the collection computer
2. Load a PowerShell prompt as administrator (this is important, in order to update/install modules)
3. Run the Get-SOAPrerequisite.ps1 script by executing the following

.\GetSOAPrerequisite.ps1 -Remediate

4. During the execution of the script, please read all prompts and notices, and provide consent to the Azure AD application which is documented below.

### Collection machine

The script must be run from the machine that you will use to perform the collection as part of the engagement. Please consider the following:
* The machine should not be a production server, as the pre-requisite script may cause a reboot during installation of modules.
* You require to be logged on as a local administrator.

## Azure AD Application

An Azure AD Application is required in order to perform API calls to Graph and SharePoint. Installation of this application is performed by the pre-requisite script, however, there are some things that you should be aware of:

The scope of this application is limited to the following:
* SecurityEvents.Read.All
* IdentityRiskyUser.Read.All
* IdentityRiskEvent.Read.All
* DeviceManagementConfiguration.Read.
* Sites.Read.All

### Azure AD Application Security

Being a Security focussed engagement, we are concerned about the security of the Azure AD Application created as part of this engagement, which is why the following security considerations are made:
* Azure AD applications are scoped only to certain activities, which are documented above. Scopes are only used when they are required, and the engagement follows a 'least permission possible' model. Most scopes are Read only and specific to configuration.
* The Azure AD Application secret is randomly generated by Azure AD on creation
* The Azure AD Application secret is only kept in memory during the operation of the scripts. It is never stored.
* Azure AD Application secrets can have expiry dates. We set the expiry date of the secret to be 48 hours.

### Removal of Azure AD Application

It is possible to remove the Azure AD Application at the conclusion of the engagement. This is not considered necessary, as the Application only has a short-lived secret and cannot be used without a valid secret. It is important however, that you do not remove the Azure AD Application in-between running the pre-requisite script and the conclusion of the engagement. 
